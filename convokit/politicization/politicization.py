from convokit.transformer import Transformer
from convokit.model import Corpus
from nltk.tokenize import word_tokenize


class PolTracker(Transformer):
    """
    Extracts information about invoking the self in utterances.

    """
    def __init__(self):
        self.ATTR_NAME = "politicization_reference_transformer"
        self.key_words = set(
            ["terms absentee ballot",
            "absolutism",
            "acquisitive model",
            "actual malice",
            "administrative adjudication",
            "affirm",
            "affirmative action",
            "agency capture",
            "agency representation",
            "agenda-setting",
            "amendment",
            "american conservatism",
            "american exceptionalism",
            "american liberalism",
            "americans with disabilities act",
            "amicus curiae brief",
            "anarchism",
            "appellate jurisdiction",
            "appointment power",
            "appropriation",
            "articles of confederation",
            "attack journalism",
            "australian ballot",
            "authoritarian regime",
            "authority",
            "authorization",
            "autocracy",
            "bad-tendency rule",
            "bakke case",
            "balanced budget",
            "bicameral legislature",
            "bilateral",
            "bill of attainder",
            "bill of rights",
            "bipartisan campaign finance reform act",
            "bipolar system",
            "blanket primary",
            "block grant",
            "blog",
            "brief",
            "broadcast media",
            "brown v. board of education of topeka",
            "kansas",
            "bundling",
            "bureaucracy",
            "buying power",
            "cabinet",
            "caesaropapism",
            "candidate-centered politics",
            "case law",
            "casework",
            "categorical grants",
            "caucus",
            "census",
            "central bank",
            "centralization",
            "centrally planned economy",
            "charter",
            "checks and balances",
            "chief of state",
            "citizen",
            "civic education",
            "civil liberties",
            "civil rights",
            "civil rights act of 1964",
            "civil rights cases",
            "civil service",
            "civil service commission",
            "civil service reform act of 1883",
            "civil service reform act of 1978",
            "civil society",
            "civil war",
            "classical conservatism",
            "classical liberalism",
            "clear-and-present danger",
            "closed primary",
            "closed rule",
            "cloture",
            "codetermination",
            "command economy",
            "commerce clause",
            "common-carrier role",
            "common law",
            "communism",
            "comparative politics",
            "concurrent powers",
            "concurring opinion",
            "confederacy",
            "confederate system",
            "conformism",
            "constituency",
            "constitution",
            "constitutional democracy",
            "constitutional government",
            "constitutional powers",
            "continuing resolution",
            "conventional participation",
            "convention delegate",
            "cooperative federalism",
            "corrupt practices acts",
            "credentials committee",
            "critical election",
            "dealignment",
            "declaration of independence",
            "de facto segregation",
            "defamation of character",
            "deficit spending",
            "de jure segregation",
            "delegated powers",
            "demand-side economics",
            "democracy",
            "democratic socialism",
            "demosclerosis",
            "denial of power",
            "deregulation",
            "deterrence",
            "devolution",
            "dictatorship",
            "diplomacy",
            "direct democracy",
            "discharge petition",
            "dissenting opinion",
            "diversity",
            "divided government",
            "divine right theory of kingship",
            "division of labor",
            "dual federalism",
            "due process clause",
            "duopoly",
            "earned income tax credit",
            "economic aid",
            "economic group",
            "economic growth",
            "effective tax rate",
            "elastic clause",
            "elector",
            "electoral college",
            "elitism/elite theory",
            "emergency powers",
            "empire",
            "enabling legislation",
            "entitlement program",
            "enumerated powers",
            "environmental impact statement",
            "environmentalism",
            "equality of opportunity",
            "equality of outcome",
            "equal protection clause",
            "equal rights amendment",
            "equal time rule",
            "equity",
            "establishment clause",
            "excess demand",
            "exclusionary rule",
            "executive leadership",
            "executive office of the president",
            "executive order",
            "executive privilege",
            "ex post facto law",
            "expressed powers",
            "fairness doctrine",
            "faithless elector",
            "fascism",
            "federal budget",
            "federal communications commission",
            "federal election campaign act",
            "federal election commission",
            "federalism",
            "federal register",
            "federal reserve bank",
            "federal system",
            "feminism",
            "filibuster",
            "first continental congress",
            "fiscal federalism",
            "fiscal policy",
            "fiscal year",
            "527 groups",
            "flat taxes",
            "food stamps",
            "foreign policy",
            "formalized rules",
            "formula grants",
            "framers",
            "franking",
            "free exercise clause",
            "free rider",
            "front-loading",
            "front-runner",
            "full faith and credit clause",
            "fundamentalism",
            "gag order",
            "gender discrimination",
            "general election",
            "general jurisdiction",
            "gerrymandering",
            "gibbons v. ogden",
            "gideon v. wainwright",
            "globalization",
            "government",
            "government accountability office",
            "government bond",
            "government corporation",
            "grandfather clause",
            "grant-in-aid",
            "grant of power",
            "grassroots activism",
            "great compromise",
            "gross domestic product",
            "guerrilla war",
            "gun control",
            "hatch act",
            "hierarchy",
            "home rule",
            "home style",
            "honeymoon period",
            "horizontal federalism",
            "hyperpluralism",
            "idealism",
            "ideology",
            "illegal participation",
            "impeachment",
            "implementation",
            "implied powers",
            "income distribution",
            "income transfer",
            "incorporation",
            "incrementalism",
            "independent",
            "independent executive agency",
            "independent regulatory agency",
            "individualism",
            "inflation",
            "informational benefits",
            "inherent powers",
            "in-kind subsidies",
            "inside game",
            "interest group",
            "international agreement",
            "internationalism",
            "international law",
            "international organization",
            "international system",
            "internet media",
            "interpretive reporting",
            "intervention",
            "iron triangle",
            "isolationism",
            "issue advertising",
            "issue network",
            "jim crow laws",
            "joint chiefs of staff",
            "judicial activism",
            "judicial implementation",
            "judicial philosophy",
            "judicial restraint",
            "judicial review",
            "jurisdiction",
            "justiciable question",
            "just-war theory",
            "keynesian economics",
            "kitchen cabinet",
            "kyoto protocol",
            "laissez-faire capitalism",
            "lawmaking",
            "layer-cake federalism",
            "legislative agenda",
            "legitimacy",
            "lemon test",
            "libel",
            "liberalism",
            "libertarianism",
            "liberty",
            "limited government",
            "limited jurisdiction",
            "limited war",
            "line-item veto",
            "line organization",
            "literacy test",
            "lobbying",
            "logrolling",
            "loophole",
            "loose constructionism",
            "madisonian model",
            "majority leader",
            "majority opinion",
            "majority party",
            "majority rule",
            "malapportionment",
            "mandate",
            "mandatory retirement",
            "marble-cake federalism",
            "markup",
            "material incentive",
            "mccain-feingold bill",
            "mcculloch v. maryland",
            "means-testing",
            "media consolidation",
            "merit system",
            "merit system protection board",
            "midterm election",
            "military aid",
            "military-industrial complex",
            "minority leader",
            "minority party",
            "miranda v. arizona",
            "mixed economy",
            "monarchy",
            "monetary policy",
            "monopolistic model",
            "monroe doctrine",
            "multiculturalism",
            "multilateralism",
            "multinational corporation",
            "multiple-member district",
            "multipolar system",
            "nation",
            "national convention",
            "national debt",
            "national interest",
            "nationalism",
            "national security council",
            "nation-building",
            "nation-state",
            "nazism",
            "necessary and proper clause",
            "necessary evil",
            "negotiated rule-making",
            "neoconservatism",
            "new deal coalition",
            "new federalism",
            "new jersey plan",
            "nihilism",
            "nineteenth amendment",
            "no child left behind act",
            "noneconomic group",
            "nongovernmental actor",
            "nongovernmental organization",
            "nuclear non-proliferation treaty",
            "objective reporting",
            "office-block ballot",
            "office of personnel management",
            "oligarchy",
            "ombudsperson",
            "open primary",
            "open rule",
            "opinion",
            "opinion leader",
            "original intent",
            "original jurisdiction",
            "outside game",
            "overregulation",
            "oversight",
            "pack journalism",
            "paradox of participation",
            "pardon",
            "parliamentary democracy",
            "partisan journalism",
            "party activist",
            "party-centered politics",
            "party-column ballot",
            "party identification",
            "party in government",
            "party in the electorate",
            "party organization",
            "party platform",
            "party reform",
            "patronage",
            "pendleton act",
            "per curiam",
            "pigeonholing",
            "plessy v. ferguson",
            "pluralism",
            "plurality",
            "plurality opinion",
            "pocket veto",
            "political action committee",
            "political appointees",
            "political culture",
            "political economy",
            "political efficacy",
            "political equality",
            "political participation",
            "political party",
            "political science",
            "political socialization",
            "politics",
            "polling",
            "pollster",
            "poll tax",
            "popular sovereignty",
            "populists",
            "pork",
            "poverty line",
            "power",
            "power of the purse",
            "precedent",
            "preemption",
            "presidential commission",
            "presidential democracy",
            "president pro tempore",
            "primary election",
            "print media",
            "prior restraint",
            "private bill",
            "private good",
            "privatization",
            "privileges and immunities clause",
            "probability sample",
            "professional legislature",
            "progressive taxes",
            "prohibited powers",
            "project grants",
            "proportional representation",
            "prospective voting",
            "proxy war",
            "public administration",
            "public assistance",
            "public education",
            "public good",
            "public opinion",
            "public policy",
            "public representative role",
            "purposive incentive",
            "rally ’round the flag effect",
            "random selection",
            "ranking member",
            "ratings game",
            "rational choice theory",
            "rationalism",
            "realignment",
            "realism",
            "reapportionment",
            "recession",
            "redistributive policy",
            "redistricting",
            "regime",
            "regressive taxes",
            "regulated federalism",
            "regulatory policy",
            "remand",
            "rent voucher",
            "representative democracy",
            "representative sample",
            "reprieve",
            "republic",
            "reregulation",
            "reserved powers",
            "responsible party",
            "retention election",
            "retrospective voting",
            "revenue agency",
            "revenue sharing",
            "reverse",
            "reverse discrimination",
            "revolution",
            "rider",
            "right of rebuttal",
            "rights of the minority",
            "roe v. wade",
            "rogue state",
            "roll-call vote",
            "rugged individualism",
            "rule-making",
            "rule of four",
            "sample",
            "sampling error",
            "school vouchers",
            "second continental congress",
            "selective incentives",
            "selective incorporation",
            "self-selected candidate",
            "senatorial courtesy",
            "separation of powers",
            "sexual harassment",
            "shays’ rebellion",
            "signing message",
            "single-member district",
            "skewed sample",
            "slander",
            "social capital",
            "socialism",
            "social security",
            "sociological representation",
            "soft money",
            "solicitor general",
            "solidarity incentive",
            "sovereignty",
            "speaker of the house",
            "special district",
            "special election",
            "specialization",
            "splinter party",
            "split-ticket voting",
            "spoiler",
            "spoils system",
            "staffer",
            "standard operating procedure",
            "stare decisis",
            "state",
            "statecraft",
            "state of the union address",
            "statute",
            "stewardship theory",
            "straight-ticket voting",
            "strict constructionism",
            "subnationalism",
            "suffrage",
            "sunset provisions",
            "sunshine laws",
            "superdelegate",
            "super tuesday",
            "supplemental security income",
            "supply-side economics",
            "supremacy clause",
            "supremacy doctrine",
            "surplus",
            "symbolic speech",
            "system of government",
            "talk radio",
            "tax credit",
            "temporary assistance to need families",
            "term limits",
            "terrorism",
            "third party",
            "three-fifths compromise",
            "totalitarian government",
            "total war",
            "transnational",
            "trickle-down economics",
            "trustee representation",
            "tyranny of the majority",
            "unconventional participation",
            "underemployment",
            "unemployment",
            "unfunded mandate",
            "unilateral",
            "unipolar",
            "unitary system",
            "unity",
            "user fee",
            "veto",
            "veto message",
            "virginia plan",
            "voter turnout",
            "voting behavior",
            "voting rights act",
            "war powers resolution",
            "washington community",
            "watchdog journalism",
            "weberian model",
            "welfare",
            "welfare state",
            "whip",
            "whistleblower",
            "white house staff",
            "white primary",
            "winner take all",
            "writ of certiorari",
            "writ of habeas corpus",
            "yellow journalism",
            "donald trump",
            "trump",
            "hillary clinton",
            "clinton",
            "barack obama",
            "obama",
            "mitt romney",
            "romney",
            "john mccain",
            "mccain",
            "george bush",
            "bush",
            "george w. bush",
            "al gore",
            "gore"])

    def transform(self, corpus: Corpus):
        """Adds metadata about self-reflection to each utterance.

        :param corpus: the corpus to compute features for.
        :type corpus: Corpus
        """
        
        for conv_id in corpus.conversations:
            conv = corpus.get_conversation(conv_id)
            for utt in conv.iter_utterances():
                if utt.text != None:
                    tokenized = word_tokenize(utt.text.lower())
                    invocations = 0
                    length = len(tokenized)
                    pol_words = []
                    for token in tokenized:
                        if token in self.key_words:
                            invocations += 1
                            pol_words.append(token)
                    utt.meta["num_pol_refs"] = invocations
                    if (length > 0):
                        utt.meta["num_pol_refs_incidence"] = (invocations/length)
                    else:
                        utt.meta["num_pol_refs_incidence"] = 0
                    utt.meta["pol_words"] = pol_words
        return corpus